<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>World Fracture</title>

<link rel="manifest" href="manifest.json">

<style>
body {
    margin:0;
    font-family:Segoe UI, sans-serif;
    text-align:center;
    color:#e6d3a3;
    background:#111;
}

.section {
    margin:20px;
    padding:15px;
    background:#1a1a1a;
    border-radius:10px;
}

button, select {
    margin:5px;
    padding:8px 12px;
    border:none;
    border-radius:6px;
    background:#3a2f1b;
    color:#e6d3a3;
}

#tensionRow { display:flex; flex-wrap:wrap; gap:5px; justify-content:center; }
.tensionBox { width:20px; height:20px; border-radius:4px; }

#weGrid { display:grid; grid-template-columns:repeat(5,1fr); gap:6px; }
.weSlot { height:35px; background:#222; border-radius:4px; }

#presenceBar { height:12px; background:#333; border-radius:5px; overflow:hidden; }
#presenceFill { height:100%; width:0%; transition:.3s; }
</style>
</head>
<body>

<h1>WORLD FRACTURE</h1>

<div class="section">
<select id="saveSlot">
<option value="slot1">Campaign Slot 1</option>
<option value="slot2">Campaign Slot 2</option>
<option value="slot3">Campaign Slot 3</option>
</select>
<button onclick="saveCampaign()">Save</button>
<button onclick="loadCampaign()">Load</button>
</div>

<div class="section">
<h2>Tension: <span id="tensionValue">0</span></h2>
<div id="tensionRow"></div>
<button onclick="increaseTension()">+Tension</button>
<button onclick="decreaseTension()">-Tension</button>
<button onclick="resetTension()">Reset</button>
</div>

<div class="section">
<h2>World Events: <span id="weCount">0</span></h2>
<div id="weGrid"></div>
</div>

<div class="section">
<h2>Presence: <span id="presenceValue">0</span></h2>
<div id="presenceBar"><div id="presenceFill"></div></div>
<button onclick="changePresence(1)">+1</button>
<button onclick="changePresence(-1)">-1</button>
<button onclick="resetPresence()">Reset</button>
</div>

<script>
let tension=0, weCount=0, tensionSinceLastWE=0, presence=0;

const tensionRow=document.getElementById("tensionRow");
const weGrid=document.getElementById("weGrid");

function getThreshold(){
 if(weCount<5)return 4;
 if(weCount<10)return 3;
 return 2;
}

function getTensionColor(){
 if(tension<10)return "#1abc9c";
 if(tension<20)return "#2ecc71";
 if(tension<30)return "#f1c40f";
 if(tension<40)return "#e67e22";
 if(tension<60)return "#e74c3c";
 return "#8b0000";
}

function increaseTension(){
 tension++; tensionSinceLastWE++;
 let color=getTensionColor();
 let box=document.createElement("div");
 box.className="tensionBox";
 box.style.background=color;
 tensionRow.appendChild(box);

 if(tensionSinceLastWE>=getThreshold()){
   let slot=document.createElement("div");
   slot.className="weSlot";
   slot.style.background=color;
   weGrid.appendChild(slot);
   weCount++;
   tensionSinceLastWE=0;
 }
 updateUI();
}

function decreaseTension(){
 if(tension<=0)return;
 tension--; tensionSinceLastWE--;
 tensionRow.removeChild(tensionRow.lastChild);
 updateUI();
}

function resetTension(){
 tension=0; weCount=0; tensionSinceLastWE=0;
 tensionRow.innerHTML=""; weGrid.innerHTML="";
 updateUI();
}

function changePresence(v){
 presence+=v; if(presence<0)presence=0;
 updateUI();
}

function resetPresence(){ presence=0; updateUI(); }

function updateUI(){
 document.getElementById("tensionValue").innerText=tension;
 document.getElementById("weCount").innerText=weCount;
 document.getElementById("presenceValue").innerText=presence;
 let fill=document.getElementById("presenceFill");
 fill.style.width=Math.min(presence*6,100)+"%";
 fill.style.background=presence>12?"darkred":"gold";
}

/* SAVE SYSTEM */
function saveCampaign(){
 let slot=document.getElementById("saveSlot").value;
 localStorage.setItem(slot,JSON.stringify({tension,weCount,tensionSinceLastWE,presence}));
 alert("Saved to "+slot);
}

function loadCampaign(){
 let slot=document.getElementById("saveSlot").value;
 let data=localStorage.getItem(slot);
 if(!data){ alert("No save found."); return; }
 let state=JSON.parse(data);
 tension=state.tension;
 weCount=state.weCount;
 tensionSinceLastWE=state.tensionSinceLastWE;
 presence=state.presence;

 tensionRow.innerHTML="";
 weGrid.innerHTML="";
 for(let i=0;i<tension;i++){
   let box=document.createElement("div");
   box.className="tensionBox";
   box.style.background=getTensionColor();
   tensionRow.appendChild(box);
 }
 for(let i=0;i<weCount;i++){
   let slot=document.createElement("div");
   slot.className="weSlot";
   slot.style.background=getTensionColor();
   weGrid.appendChild(slot);
 }
 updateUI();
}

/* PWA REGISTER */
if('serviceWorker' in navigator){
 navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>