<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>World Fracture</title>

<style>
body{
    font-family: serif;
    background:#111;
    color:#e6d3a3;
    text-align:center;
}
.section{
    margin:20px;
    padding:15px;
    background:#1a1a1a;
    border-radius:10px;
}
button{
    margin:5px;
    padding:8px 12px;
}
#presenceBar{
    height:16px;
    width:100%;
    background:#333;
    border-radius:8px;
    overflow:hidden;
}
#presenceFill{
    height:100%;
    width:0%;
}
.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.9);
    display:none;
    align-items:center;
    justify-content:center;
}
.modal-content{
    background:#1a1a1a;
    padding:25px;
    border-radius:10px;
    width:90%;
    max-width:500px;
}
</style>
</head>
<body>

<h1>WORLD FRACTURE</h1>

<div class="section">
<h2>Tension: <span id="tensionValue">0</span></h2>
<button onclick="increaseTension()">+Tension</button>
<button onclick="drawWorldEvent()">Force Event</button>
</div>

<div class="section">
<h2>Presence: <span id="presenceValue">0</span></h2>
<div id="presenceBar">
<div id="presenceFill"></div>
</div>
<button onclick="changePresence(1)">+1</button>
<button onclick="changePresence(-1)">-1</button>
</div>

<div class="modal" id="eventModal">
<div class="modal-content">
<h2 id="eventTitle"></h2>
<p id="eventText"></p>
<div id="eventOptions"></div>
</div>
</div>

<script src="events.js"></script>

<script>

let tension = 0;
let presence = 0;

function increaseTension(){
    tension++;
    document.getElementById("tensionValue").textContent = tension;

    if(tension >= 4){
        tension = 0;
        document.getElementById("tensionValue").textContent = tension;
        drawWorldEvent();
    }
}

function changePresence(v){
    presence += v;
    if(presence < 0) presence = 0;

    document.getElementById("presenceValue").textContent = presence;

    let percent = Math.min((presence/10)*100,100);
    document.getElementById("presenceFill").style.width = percent + "%";
}

function drawWorldEvent(){

    if(typeof worldEventPools === "undefined"){
        console.error("events.js not loaded");
        return;
    }

    let pool = worldEventPools.act1;

    if(!pool || pool.length === 0){
        console.error("No events found");
        return;
    }

    let randomIndex = Math.floor(Math.random() * pool.length);
    let event = pool[randomIndex];

    openEventModal(event);
}

function openEventModal(event){

    document.getElementById("eventTitle").textContent = event.title;
    document.getElementById("eventText").textContent = event.text;

    let container = document.getElementById("eventOptions");
    container.innerHTML = "";

    event.options.forEach(o=>{
        let btn = document.createElement("button");
        btn.textContent = o.label + " [" + o.tag + "]";
        btn.onclick = ()=>document.getElementById("eventModal").style.display="none";
        container.appendChild(btn);
    });

    document.getElementById("eventModal").style.display="flex";
}

</script>
</body>
</html>
