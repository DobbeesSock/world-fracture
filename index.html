<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>World Fracture</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    font-family:'Cinzel', serif;
    background:#111;
    color:#e6d3a3;
    text-align:center;
}

.section{
    margin:20px;
    padding:15px;
    background:#1a1a1a;
    border-radius:10px;
}

button, select, input{
    margin:5px;
    padding:8px 12px;
    border:none;
    border-radius:6px;
    background:#3a2f1b;
    color:#e6d3a3;
    cursor:pointer;
}

/* TENSION */

#tensionRow{
    display:flex;
    flex-wrap:wrap;
    gap:5px;
    justify-content:center;
}

.tensionBox{
    width:20px;
    height:20px;
    border-radius:4px;
}

#weGrid{
    display:grid;
    grid-template-columns:repeat(5,1fr);
    gap:6px;
}

.weSlot{
    height:35px;
    border-radius:4px;
}

/* PRESENCE */

#presenceBar{
    height:16px;
    width:100%;
    background:#333;
    border-radius:8px;
    overflow:hidden;
}

#presenceFill{
    height:100%;
    width:0%;
    transition:width .3s ease, background .3s ease;
}

/* LOG */

#logContainer{
    max-height:200px;
    overflow-y:auto;
    background:#111;
    padding:10px;
    border-radius:6px;
    text-align:left;
    font-size:0.9em;
}

/* MODAL */

.modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.9);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:1000;
}

.modal-content{
    background:#1a1a1a;
    padding:25px;
    border-radius:10px;
    width:90%;
    max-width:500px;
    text-align:left;
}

.optionBtn{
    display:block;
    width:100%;
    margin:8px 0;
    text-align:left;
}

#effectBox{
    margin-top:15px;
    padding:10px;
    background:#222;
    border-radius:6px;
    display:none;
}

#confirmBtn{
    margin-top:10px;
    display:none;
}
</style>
</head>
<body>

<h1>WORLD FRACTURE</h1>

<div class="section">
<select id="saveSlot">
<option value="slot1">Campaign Slot 1</option>
<option value="slot2">Campaign Slot 2</option>
<option value="slot3">Campaign Slot 3</option>
</select>
<button onclick="saveCampaign()">Save</button>
<button onclick="loadCampaign()">Load</button>
<button onclick="newCampaign()">New Campaign</button>
</div>

<div class="section">
<h2>Current Act</h2>
<select id="actSelector" onchange="switchAct()">
<option value="act1">Act I</option>
<option value="act2">Act II</option>
<option value="act3">Act III</option>
</select>
</div>

<div class="section">
<h2>Tension: <span id="tensionValue">0</span></h2>
<div id="tensionRow"></div>
<button onclick="increaseTension()">+Tension</button>
<button onclick="decreaseTension()">-Tension</button>
<button onclick="resetTension()">Reset</button>
</div>

<div class="section">
<h2>World Events: <span id="weCount">0</span></h2>
<div id="weGrid"></div>
</div>

<div class="section">
<h2>Presence: <span id="presenceValue">0</span></h2>
<div id="presenceBar">
<div id="presenceFill"></div>
</div>
<div>Tier: <span id="presenceTier">0–2</span></div>
<button onclick="changePresence(1)">+1</button>
<button onclick="changePresence(-1)">-1</button>
<button onclick="resetPresence()">Reset</button>
</div>

<div class="section">
<h2>Cave Log</h2>
<div id="logContainer"></div>
<button onclick="clearLog()">Clear Log</button>
</div>

<div class="modal" id="eventModal">
<div class="modal-content">
<h2 id="eventTitle"></h2>
<p id="eventText"></p>
<div id="eventOptions"></div>
<div id="effectBox"></div>
<button id="confirmBtn">Confirm Resolution</button>
</div>
</div>

<script>

/* STATE */

let tension=0,weCount=0,tensionSinceLastWE=0,presence=0;
let logEntries=[];
let currentAct="act1";
let usedEventsByAct={act1:[],act2:[],act3:[]};
let selectedEventTitle="",selectedTag="";

const tensionRow=document.getElementById("tensionRow");
const weGrid=document.getElementById("weGrid");

/* EVENT POOLS */

const worldEventPools={
act1:[

{
title:"The World Anchor ⚖️",
text:"A titanic spike of stone plunges endlessly downward.",
options:[
{label:"Reinforce",tag:"Order",effect:"All factions gain 1 Relic."},
{label:"Damage",tag:"Profit",effect:"Spawn a World Boss."}
]
},

{
title:"The Silent Contract ⚖️",
text:"A stone table waits for signatures.",
options:[
{label:"Sign Together",tag:"Alliance",effect:"Ignore hostility once this campaign."},
{label:"Refuse",tag:"Independence",effect:"Gain 2 Legendary Potions."}
]
},

{
title:"The Blood Moon Ascends",
text:"The red moon rises.",
options:[
{label:"United Circle",tag:"Unity",effect:"Contribute 5 Food each. Banish threats."},
{label:"Reckless Stand",tag:"Blood",effect:"Gain +20 Gold. Spawn Table Beast."}
]
},
{
title:"The Shared Grave ⚖️",
text:"Every faction’s banners hang here—old, tattered, impossible.",
options:[
{label:"Honor the Dead",tag:"Reverence",effect:"All factions gain 1 Move & Attack Upgrade. Graveyard spawn cost x3 this mission."},
{label:"Loot the Graves",tag:"Desecration",effect:"Each faction gains 1 Chest Card. Unit deaths heal Creatures 3 HP this mission."},
{label:"Burn the Banners",tag:"Defiance",effect:"Each faction loses 3 Metal."}
]
},

{
title:"The Hunger Beneath Empires ⚖️",
text:"The ground pulses across the entire map. It feeds on excess.",
options:[
{label:"Feed It Regularly",tag:"Appeasement",effect:"Each faction sacrifices 15 resources."},
{label:"Starve It",tag:"Greed",effect:"Each faction gains +14 Gold or +14 Food."},
{label:"Try to Kill It",tag:"Reckoning",effect:"Roll 1d6. Success (4-6): +3 Dragon Coins each. Failure (1-3): lose 9 Metal each."}
]
},

{
title:"The Last Descent ⚖️",
text:"It offers no choices. Only a mirror.",
options:[
{label:"Judgment",tag:"Judgment",effect:"Faction with highest setup loses 2 units. All others gain 1 Rare Potion."}
]
},

{
title:"The First Betrayal",
text:"The caves replay a moment that hasn’t happened yet.",
options:[
{label:"Name the Traitor",tag:"Fracture",effect:"Chosen faction gains +1 Attack Action Upgrade."},
{label:"Deny the Vision",tag:"Fracture",effect:"Cancel one future Table-Wide event. Presence +2."}
]
},

{
title:"Bloodied Field",
text:"The dead outnumber the living.",
options:[
{label:"Bury the Elect Few",tag:"Remembrance",effect:"All factions gain 1 Relic and +1 Campaign Point."},
{label:"Scavenge the Field",tag:"Greed",effect:"Each faction gains 1 Blueprint or may lose 2 units for 1 Chest Card."}
]
},

{
title:"The Golden Collapse",
text:"A city-sized vault buckles deep below.",
options:[
{label:"Take the Gold",tag:"Inflation",effect:"All factions gain 14 Gold. Exchange becomes 6:1. Presence +2."}
]
},

{
title:"The Vault That Should Not Open",
text:"A single lock. Every key fits.",
options:[
{label:"Open It Together",tag:"Temptation",effect:"Split 2 Mythic Rewards. Spawn World Boss."},
{label:"Seal It Forever",tag:"Restraint",effect:"Presence -3. Lose access to Mythic Rewards."}
]
},

{
title:"The Cave Remembers the Sun",
text:"The underworld recalls light—and wants it back.",
options:[
{label:"Night Falls",tag:"Reversal",effect:"Nighttime triggers this mission and next. Caves gain +2 Stability."}
]
},

{
title:"The World Demands Tribute",
text:"Supply lines strain as the land exacts cost.",
options:[
{label:"Pay the Land",tag:"Order",effect:"Each faction pays 10 Food."},
{label:"Refuse",tag:"Defiance",effect:"Spawn The Hunger of Many at most contested POI. It immediately acts."}
]
},

{
title:"Banners Draw Blood",
text:"So many standards fly that war can no longer be ignored.",
options:[
{label:"Yield",tag:"Submission",effect:"Lose 2 Keywords of your choice."},
{label:"Stand Proud",tag:"Pride",effect:"Gain +10 Gold. Spawn keyword-hunting creature."}
]
},

{
title:"The Map Is Redrawn",
text:"Old paths collapse. New ones open.",
options:[
{label:"Stabilize the Region",tag:"Order",effect:"No map changes. All factions gain +5 Food."},
{label:"Let It Shift",tag:"Chaos",effect:"Remove one central POI. Replace with Hazardous Terrain 3x3. Most Dragon Coins +1."}
]
},

{
title:"The Champion Calls",
text:"A challenge rings out.",
options:[
{label:"Commit",tag:"Glory",effect:"Send 1 unit to Arena. If 2+ commit, spawn Arena Champion."},
{label:"Decline",tag:"Caution",effect:"Gain +5 Gold."}
]
},

{
title:"The Council Convenes",
text:"Commanders gather. Power shifts openly.",
options:[
{label:"Send Commander",tag:"Influence",effect:"Gain +10 Gold. Most present gains 1 Blueprint."},
{label:"Abstain",tag:"Neutral",effect:"No effect."}
]
},

{
title:"Rumours of Betrayal",
text:"Something is coming. No one agrees on what.",
options:[
{label:"Reveal Reserves",tag:"Transparency",effect:"Lose 10 Gold. Gain 1 Mythic Potion."},
{label:"Conceal Assets",tag:"Deception",effect:"Gain +10 Gold. Spawn keyword-hunter."}
]
},

{
title:"The Storm Breaks",
text:"The sky no longer tolerates defiance.",
options:[
{label:"Seek Shelter",tag:"Caution",effect:"All factions skip 1 round. No spawns."},
{label:"Press On",tag:"Defiance",effect:"Ignore terrain penalties. Spawn Stormward Avatar."}
]
},

{
title:"Oaths Are Tested",
text:"Words spoken in iron are tested by fire.",
options:[
{label:"Honour the Oath",tag:"Honor",effect:"Lose 5 Gold."},
{label:"Exploit the Moment",tag:"Greed",effect:"Gain +10 Gold. Spawn Oathbreaker Behemoth."}
]
},

{
title:"The Ground Trembles",
text:"Rumbles erupt from below.",
options:[
{label:"Stabilize Fault Lines",tag:"Order",effect:"Table pays 15 Metal split. All factions +15 Food."},
{label:"Feed the Rupture",tag:"Chaos",effect:"Spawn World Boss. Most Dragon Coins +2."}
]
},
{
title:"The Council of Shades",
text:"Ancient spirits demand tribute — or punish all for silence.",
options:[
{label:"Tribute",tag:"Submission",effect:"Lose 10 Gold. Gain +5 Metal, +5 Food, or 1 Relic."},
{label:"Defiance",tag:"Defiance",effect:"If majority defy, spawn keyword-hunter targeting faction with most keywords."}
]
},

{
title:"The Broken Celestial Clock",
text:"A cosmic mechanism fractures, twisting time.",
options:[
{label:"Anchor Time",tag:"Control",effect:"Skip 1 Movement. Gain 1 Random Potion."},
{label:"Bend Time",tag:"Distortion",effect:"Extra Attack next Phase. Lose 10 Food. Spawn Creature."}
]
},

{
title:"The Blood Moon Ascends",
text:"The red moon rises and the dead answer its call.",
options:[
{label:"United Circle",tag:"Unity",effect:"All contribute 5 Food. Banish current threats. Gain 1 Relic each."},
{label:"Reckless Stand",tag:"Blood",effect:"All gain +20 Gold. Spawn Table Beast."}
]
},

{
title:"The Whispers of Time",
text:"Echoes of what has been tug at reality.",
options:[
{label:"Listen",tag:"Insight",effect:"Increase World Tension +1."},
{label:"Silence",tag:"Control",effect:"Lose 10 Gold. All factions gain +1 Dragon Coin."}
]
},

{
title:"Shivering Winds",
text:"Cold gusts rob supplies.",
options:[
{label:"Endure the Cold",tag:"Suffering",effect:"All factions lose 15 Food."},
{label:"Delay Movement",tag:"Delay",effect:"Skip all Movement next Phase."},
{label:"Freeze Weapons",tag:"Weakness",effect:"All unit attacks -2 damage next Phase."}
]
},

{
title:"Fading Light",
text:"Vision dims and secrecy looms.",
options:[
{label:"Hold Camp",tag:"Caution",effect:"Skip a unit action to gain +7 Gold."},
{label:"Press On",tag:"Resolve",effect:"All units move -3 next Phase."}
]
},

{
title:"Rumbling Nearby",
text:"A tremor shakes the map.",
options:[
{label:"Endure",tag:"Omen",effect:"Presence +2."}
]
},

{
title:"Cries in the Dark",
text:"Something hunts in shadow.",
options:[
{label:"Face the Dark",tag:"Risk",effect:"Roll 1d6. 4-6 gain 1 Random Potion. 1-3 lose 10 Gold."}
]
},

{
title:"Market Fluctuation",
text:"Trade routes tighten then boom.",
options:[
{label:"Profit",tag:"Wealth",effect:"Each faction gains +10 Gold."}
]
},

{
title:"The Black Mirror Crevasse",
text:"A jagged rift reflects not faces — but intentions.",
options:[
{label:"Ally",tag:"Trust",effect:"Gain 1 Random Potion. If all Ally, all gain 1 Relic."},
{label:"Betray",tag:"Betrayal",effect:"Steal 10 Gold from an Ally. If 2+ Betray, spawn keyword-hunter."}
]
},

{
title:"The Gnawing Deep",
text:"Something hungry tunnels upward.",
options:[
{label:"Feed the Deep",tag:"Appeasement",effect:"Lose 10 Food. Gain +10 Gold."},
{label:"Starve It",tag:"Defiance",effect:"Lose 1 unit if you choose this."}
]
},

{
title:"The Echoing Pit of Oaths",
text:"Ancient promises claw back to the surface.",
options:[
{label:"Honor Old Oaths",tag:"Honor",effect:"Lose 5 Gold. Gain +10 Food."},
{label:"Break Them",tag:"Betrayal",effect:"Gain +20 Gold. Spawn Oathbreaker Behemoth."}
]
},

{
title:"The Vein of Living Metal",
text:"A seam of shifting metal splits the earth.",
options:[
{label:"Contribute Metal",tag:"Investment",effect:"Highest gains +2 Blueprints. Second gains +20 Gold."},
{label:"Contribute Nothing",tag:"Scavenger",effect:"Gain Scavenger keyword. Contributors lose 5 Metal."}
]
},

{
title:"The Throneless Hollow",
text:"A buried chamber where no ruler survived.",
options:[
{label:"Offer the Commander",tag:"Sacrifice",effect:"Remove Commander. Gain +2 Dragon Coins."},
{label:"Protect the Commander",tag:"Pride",effect:"Other factions may attack that Commander."}
]
},

{
title:"The Fractured Alliance",
text:"A binding pact shatters.",
options:[
{label:"Bind Together",tag:"Unity",effect:"All gain +1 Dragon Coin. Presence -2."},
{label:"Break Away",tag:"Betrayal",effect:"Steal 10 Gold from a bound faction. Presence +1."}
]
},

{
title:"The Resource War",
text:"Scarcity spreads.",
options:[
{label:"Hoard",tag:"Greed",effect:"Gain +15 Gold."},
{label:"Share",tag:"Unity",effect:"Sharers gain +10 Food."},
{label:"Seize",tag:"Aggression",effect:"Steal 10 Food from target. If 2+ Seize, spawn Conflict Beast."}
]
},

{
title:"The Tithe of Power",
text:"The world demands sacrifice.",
options:[
{label:"Sacrifice Unit",tag:"Sacrifice",effect:"Gain 1 Relic."},
{label:"Sacrifice Gold",tag:"Payment",effect:"Lose 15 Gold."},
{label:"Refuse",tag:"Defiance",effect:"Lose 1 Dragon Coin. If none sacrifice, spawn World Devourer."}
]
},

{
title:"The Veil Thins",
text:"Secrets become weapons.",
options:[
{label:"Reveal and Steal",tag:"Exposure",effect:"Reveal 1 resource and steal 5 of it from chosen faction."}
]
},

{
title:"The Ascension Offer",
text:"A single faction may ascend.",
options:[
{label:"Vote",tag:"Power",effect:"Most votes gains +2 Dragon Coins and loses 15 Food."}
]
},

{
title:"The Shared Burden",
text:"A catastrophe looms.",
options:[
{label:"Contribute Gold",tag:"Unity",effect:"If total ≥50 prevent disaster and gain 1 Relic. If not, spawn Cataclysm Titan."}
]
},

{
title:"The Claiming",
text:"A central POI destabilizes.",
options:[
{label:"Bid Food",tag:"Ambition",effect:"Highest bidder claims POI and gains +2 Dragon Coins."}
]
},

{
title:"The Shadow Exchange",
text:"A secret trade is offered.",
options:[
{label:"Trade",tag:"Alliance",effect:"Mutual trade: both gain 1 Relic."},
{label:"Sabotage",tag:"Betrayal",effect:"Steal 1 Dragon Coin. Mutual sabotage spawns Shadow Hunter."}
]
},

{
title:"The Final Rift",
text:"The world cracks open.",
options:[
{label:"Fortify",tag:"Defense",effect:"+20 Food. Lose 1 Dragon Coin."},
{label:"Expand",tag:"Ambition",effect:"+1 POI Influence. Presence +1."},
{label:"Exploit",tag:"Greed",effect:"+20 Gold. Spawn creature targeting you."}
]
},

{
title:"The Reckoning Vote",
text:"A faction must fall.",
options:[
{label:"Vote to Weaken",tag:"Judgment",effect:"Most votes lose 1 Dragon Coin and 1 unit. If unanimous, they gain 1 Relic."}
]
},

{
title:"The World Decides",
text:"The world judges alignment.",
options:[
{label:"Declare Order",tag:"Order",effect:"Majority gains +1 Dragon Coin."},
{label:"Declare Freedom",tag:"Freedom",effect:"Majority gains +1 Dragon Coin."},
{label:"Declare Profit",tag:"Profit",effect:"Majority gains +1 Dragon Coin. If evenly split, Presence +3."}
]
}

],
act2:[],
act3:[]
};

/* ACT SWITCH */

function switchAct(){
let newAct=document.getElementById("actSelector").value;
if(newAct===currentAct)return;

if(!confirm("Switching Acts resets Tension. Continue?")){
document.getElementById("actSelector").value=currentAct;
return;
}

currentAct=newAct;
resetTension();
addLog("Switched to "+currentAct.toUpperCase());
}

/* WORLD EVENT DRAW */

function drawWorldEvent(){
let pool=worldEventPools[currentAct];
let used=usedEventsByAct[currentAct];

if(pool.length===0){
addLog("No events in this Act.");
return;
}

if(used.length===pool.length){
usedEventsByAct[currentAct]=[];
used=[];
}

let available=pool.filter((_,i)=>!used.includes(i));
let randomIndex=Math.floor(Math.random()*available.length);
let eventIndex=pool.indexOf(available[randomIndex]);

used.push(eventIndex);
openEventModal(pool[eventIndex]);
}

function openEventModal(event){
selectedEventTitle=event.title;
document.getElementById("eventTitle").innerText=event.title;
document.getElementById("eventText").innerText=event.text;

let container=document.getElementById("eventOptions");
container.innerHTML="";
document.getElementById("effectBox").style.display="none";
document.getElementById("confirmBtn").style.display="none";

event.options.forEach(o=>{
let btn=document.createElement("button");
btn.className="optionBtn";
btn.innerText=o.label+" ["+o.tag+"]";
btn.onclick=()=>showEffect(o.tag,o.effect);
container.appendChild(btn);
});

document.getElementById("eventModal").style.display="flex";
}

function showEffect(tag,effect){
selectedTag=tag;
let box=document.getElementById("effectBox");
box.innerText=effect;
box.style.display="block";
let confirmBtn=document.getElementById("confirmBtn");
confirmBtn.style.display="block";
confirmBtn.onclick=confirmResolution;
}

function confirmResolution(){
addLog(selectedEventTitle+" — "+selectedTag);
document.getElementById("eventModal").style.display="none";
}

/* TENSION */

function getThreshold(){
if(weCount<5)return 4;
if(weCount<10)return 3;
return 2;
}

function increaseTension(){
tension++;tensionSinceLastWE++;
document.getElementById("tensionValue").innerText=tension;

let box=document.createElement("div");
box.className="tensionBox";
box.style.background="#e74c3c";
tensionRow.appendChild(box);

if(tensionSinceLastWE>=getThreshold()){
let slot=document.createElement("div");
slot.className="weSlot";
slot.style.background="#e74c3c";
weGrid.appendChild(slot);
weCount++;tensionSinceLastWE=0;
document.getElementById("weCount").innerText=weCount;
drawWorldEvent();
}
}

function decreaseTension(){
if(tension<=0)return;
tension--;
tensionRow.removeChild(tensionRow.lastChild);
document.getElementById("tensionValue").innerText=tension;
}

function resetTension(){
tension=0;weCount=0;tensionSinceLastWE=0;
tensionRow.innerHTML="";
weGrid.innerHTML="";
document.getElementById("tensionValue").innerText=0;
document.getElementById("weCount").innerText=0;
}

/* PRESENCE */

function updatePresence(){
document.getElementById("presenceValue").innerText=presence;
let percent=Math.min((presence/15)*100,100);
let fill=document.getElementById("presenceFill");
fill.style.width=percent+"%";

if(presence<=2)fill.style.background="#1abc9c";
else if(presence<=4)fill.style.background="#2ecc71";
else if(presence<=6)fill.style.background="#f1c40f";
else if(presence<=8)fill.style.background="#e67e22";
else if(presence<=10)fill.style.background="#e74c3c";
else fill.style.background="#8b0000";
}

function changePresence(v){
presence+=v;
if(presence<0)presence=0;
updatePresence();
}

function resetPresence(){
presence=0;
updatePresence();
}

/* LOG */

function addLog(msg){
let time=new Date().toLocaleTimeString();
logEntries.unshift("["+time+"] "+msg);
renderLog();
}

function renderLog(){
let c=document.getElementById("logContainer");
c.innerHTML="";
logEntries.forEach(e=>{
let d=document.createElement("div");
d.textContent=e;
c.appendChild(d);
});
}

function clearLog(){logEntries=[];renderLog();}

/* SAVE */

function saveCampaign(){
let slot=document.getElementById("saveSlot").value;
localStorage.setItem(slot,JSON.stringify({
tension,weCount,tensionSinceLastWE,presence,currentAct
}));
alert("Saved.");
}

function loadCampaign(){
let slot=document.getElementById("saveSlot").value;
let data=localStorage.getItem(slot);
if(!data)return;
let state=JSON.parse(data);

tension=state.tension||0;
weCount=state.weCount||0;
tensionSinceLastWE=state.tensionSinceLastWE||0;
presence=state.presence||0;
currentAct=state.currentAct||"act1";

document.getElementById("actSelector").value=currentAct;

resetTension();
for(let i=0;i<tension;i++)increaseTension();
updatePresence();
}

function newCampaign(){
if(!confirm("Start new campaign?"))return;
resetTension();
resetPresence();
clearLog();
}

updatePresence();

</script>
</body>
</html>
